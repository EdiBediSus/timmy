<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Are You a Timmy? Quiz</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 700px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .header h1 {
            color: white;
            font-size: 36px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.2);
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .content {
            padding: 40px 30px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-bar {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .menu-btn, .answer-btn, .submit-btn, .back-btn {
            width: 100%;
            padding: 18px 24px;
            margin: 12px 0;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-family: 'Poppins', sans-serif;
        }

        .menu-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .menu-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.2);
            transition: left 0.5s ease;
        }

        .menu-btn:hover::before {
            left: 100%;
        }

        .menu-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .answer-btn {
            background: white;
            color: #333;
            border: 3px solid #e8eaf6;
            text-align: left;
            position: relative;
        }

        .answer-btn:hover:not(:disabled) {
            border-color: #667eea;
            background: #f5f7fa;
            transform: translateX(5px);
        }

        .answer-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .submit-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(245, 87, 108, 0.4);
        }

        .back-btn {
            background: #e8eaf6;
            color: #667eea;
        }

        .back-btn:hover {
            background: #d1d5f0;
        }

        .question-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .question-text {
            font-size: 20px;
            line-height: 1.6;
            color: #333;
            font-weight: 600;
        }

        .progress-bar {
            background: #e8eaf6;
            height: 12px;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            margin-bottom: 15px;
            color: #666;
            font-size: 14px;
            font-weight: 600;
        }

        .result-card {
            text-align: center;
            padding: 50px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        }

        .result-title {
            font-size: 32px;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .result-score {
            font-size: 72px;
            font-weight: 700;
            margin: 25px 0;
            text-shadow: 4px 4px 12px rgba(0,0,0,0.3);
        }

        .result-desc {
            font-size: 18px;
            margin-top: 20px;
            line-height: 1.6;
        }

        .input-box {
            width: 100%;
            padding: 18px;
            margin: 15px 0;
            border: 3px solid #e8eaf6;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }

        .input-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            margin: 12px 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .leaderboard-item:hover {
            transform: translateX(5px);
        }

        .leaderboard-rank {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            min-width: 50px;
        }

        .leaderboard-name {
            flex: 1;
            padding: 0 20px;
            font-weight: 600;
            color: #333;
        }

        .leaderboard-score {
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 700;
            color: #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-weight: 600;
        }

        .emoji {
            font-size: 64px;
            margin-bottom: 20px;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 28px;
            }
            .question-text {
                font-size: 18px;
            }
            .result-score {
                font-size: 56px;
            }
            .content {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§î Are You a Timmy? ü§î</h1>
        </div>

        <div class="content">
            <!-- MENU SCREEN -->
            <div id="menuScreen" class="screen active">
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-label">Player</div>
                        <div class="stat-value" id="playerNameDisplay">Guest</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Quiz Streak</div>
                        <div class="stat-value" id="timmyPointsDisplay">0</div>
                    </div>
                </div>
                <button class="menu-btn" onclick="showNameInput()">üéÆ Start Quiz</button>
                <button class="menu-btn" onclick="showLeaderboard()">üèÜ Leaderboard</button>
                <button class="menu-btn" onclick="showSettings()">‚öôÔ∏è Settings</button>
            </div>

            <!-- NAME INPUT SCREEN -->
            <div id="nameScreen" class="screen">
                <div class="question-box">
                    <p class="question-text">Enter your name to begin:</p>
                </div>
                <input type="text" id="nameInput" class="input-box" maxlength="20" placeholder="Your name...">
                <button class="submit-btn" onclick="startQuiz()">Let's Go!</button>
                <button class="back-btn" onclick="showMenu()">‚Üê Back</button>
            </div>

            <!-- QUIZ SCREEN -->
            <div id="quizScreen" class="screen">
                <div class="progress-text">
                    Question <span id="questionNum">1</span> of 10
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 10%"></div>
                </div>
                <div class="question-box">
                    <div class="question-text" id="questionText"></div>
                </div>
                <div id="answersContainer"></div>
            </div>

            <!-- RESULT SCREEN -->
            <div id="resultScreen" class="screen">
                <div class="result-card">
                    <div class="emoji" id="resultEmoji"></div>
                    <div class="result-title" id="resultTitle"></div>
                    <div class="result-score" id="resultScore"></div>
                    <div class="result-desc" id="resultDesc"></div>
                </div>
                <button class="menu-btn" onclick="retryQuiz()">üîÑ Try Again</button>
                <button class="menu-btn" onclick="showLeaderboard()">üèÜ View Leaderboard</button>
                <button class="back-btn" onclick="showMenu()">‚Üê Back to Menu</button>
            </div>

            <!-- LEADERBOARD SCREEN -->
            <div id="leaderboardScreen" class="screen">
                <div class="question-box">
                    <p class="question-text">üèÜ Top Timmys üèÜ</p>
                </div>
                <div id="leaderboardList">
                    <div class="loading">Loading...</div>
                </div>
                <button class="back-btn" onclick="showMenu()">‚Üê Back</button>
            </div>

            <!-- SETTINGS SCREEN -->
            <div id="settingsScreen" class="screen">
                <div class="question-box">
                    <p class="question-text">‚öôÔ∏è Settings</p>
                </div>
                <button class="menu-btn" onclick="resetProgress()">üóëÔ∏è Reset Progress</button>
                <p style="text-align: center; color: #666; margin: 20px 0; font-size: 14px;">
                    This will delete your local progress and stats
                </p>
                <button class="back-btn" onclick="showMenu()">‚Üê Back</button>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://kjsdccbliyxjtdtjivyw.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtqc2RjY2JsaXl4anRkdGppdnl3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3NTQyNDksImV4cCI6MjA4MzMzMDI0OX0.9rAQOTN48PBtbBSa8DRC-4symk3LNU3FNUMHqPetsCA';

        const QUESTION_BANK = [
            {
                q: "You're trying to make instant ramen. What's your first move?",
                options: ["Read the instructions", "Add water and microwave it", "Just eat it dry with the seasoning", "Google 'how to make ramen'"],
                timmy: [2, 3]
            },
            {
                q: "Someone says 'break a leg' before your presentation. What do you do?",
                options: ["Say thanks and give your presentation", "Ask them why they want you to get hurt", "Literally avoid breaking your leg all day", "Report them to HR"],
                timmy: [1, 2, 3]
            },
            {
                q: "You need to be somewhere in 30 minutes and it's a 10-minute drive. When do you leave?",
                options: ["In 15-20 minutes", "Right now immediately", "In 29 minutes", "Never, I'll just be late"],
                timmy: [2, 3]
            },
            {
                q: "The recipe says 'let it simmer for 20 minutes'. What does that mean to you?",
                options: ["Cook it on low heat for 20 minutes", "Stare at it for 20 minutes", "Turn the heat to max for faster cooking", "Set a timer for exactly 20 minutes and leave the house"],
                timmy: [1, 2, 3]
            },
            {
                q: "You see a 'Wet Floor' sign. What's your reaction?",
                options: ["Walk carefully around it", "Test how wet it is with my foot", "Ignore it completely", "Take a picture of it for some reason"],
                timmy: [1, 3]
            },
            {
                q: "Your phone battery is at 1%. What do you do?",
                options: ["Plug it in immediately", "Keep using it to see how long it lasts", "Start an important phone call", "Take a bunch of photos"],
                timmy: [1, 2, 3]
            },
            {
                q: "The instructions say 'Some assembly required'. Your move?",
                options: ["Read the instructions carefully", "Just start putting pieces together randomly", "Throw away the instructions immediately", "Call someone to do it for me"],
                timmy: [1, 2, 3]
            },
            {
                q: "You're at a buffet. How do you approach it?",
                options: ["Take small portions of things I want to try", "Fill my plate until it's a mountain", "Take one of everything", "Ask for a to-go box before I start"],
                timmy: [1, 2, 3]
            },
            {
                q: "Someone texts you 'K'. What does it mean?",
                options: ["They're acknowledging what I said", "They're furious with me", "It's a typo", "It's a secret code"],
                timmy: [1, 2, 3]
            },
            {
                q: "You're told to 'just be yourself' at a job interview. What do you do?",
                options: ["Be professional but authentic", "Show up in pajamas", "Tell them my entire life story", "Bring my pets"],
                timmy: [1, 2, 3]
            },
            {
                q: "The milk expires tomorrow. What's your plan?",
                options: ["Use it today or tomorrow", "Throw it away right now", "Ignore the date completely", "Freeze it for later"],
                timmy: [1, 3]
            },
            {
                q: "You see 'Please knock before entering'. What do you do?",
                options: ["Knock and wait for a response", "Knock while opening the door", "Just walk in", "Stand outside forever"],
                timmy: [1, 2, 3]
            },
            {
                q: "Your GPS says 'Turn left in 500 feet'. When do you turn?",
                options: ["When I see the turn or reach 500 feet", "Immediately", "Count out 500 footsteps", "Panic and miss the turn"],
                timmy: [1, 2, 3]
            },
            {
                q: "The oven is preheated. What does that mean?",
                options: ["It's reached the temperature I set", "It's thinking about getting hot", "It's broken", "I need to heat it more"],
                timmy: [1, 2, 3]
            },
            {
                q: "Someone says 'sleep on it' about a decision. What do you do?",
                options: ["Think about it overnight before deciding", "Put the decision under my pillow", "Take a nap right now", "Write it down and literally sleep on the paper"],
                timmy: [1, 2, 3]
            }
        ];

        let currentQuestions = [];
        let currentQuestion = 0;
        let score = 0;
        let playerName = '';
        let timmyPoints = 0;

        window.onload = function() {
            loadProgress();
            updateStats();
        };

        function loadProgress() {
            const saved = localStorage.getItem('timmyProgress');
            if (saved) {
                const data = JSON.parse(saved);
                playerName = data.playerName || '';
                timmyPoints = data.timmyPoints || 0;
            }
        }

        function saveProgress() {
            localStorage.setItem('timmyProgress', JSON.stringify({
                playerName: playerName,
                timmyPoints: timmyPoints
            }));
        }

        function updateStats() {
            document.getElementById('playerNameDisplay').textContent = playerName || 'Guest';
            document.getElementById('timmyPointsDisplay').textContent = timmyPoints;
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function showMenu() {
            showScreen('menuScreen');
        }

        function showNameInput() {
            showScreen('nameScreen');
            document.getElementById('nameInput').value = playerName;
        }

        function showSettings() {
            showScreen('settingsScreen');
        }

        function resetProgress() {
            if (confirm('Are you sure you want to delete all your progress?')) {
                localStorage.removeItem('timmyProgress');
                playerName = '';
                timmyPoints = 0;
                updateStats();
                alert('Progress deleted successfully!');
            }
        }

        function startQuiz() {
            const name = document.getElementById('nameInput').value.trim();
            if (!name) {
                alert('Please enter your name!');
                return;
            }
            playerName = name;
            saveProgress();
            updateStats();
            
            generateQuestions();
            showScreen('quizScreen');
            showQuestion();
        }

        function generateQuestions() {
            const shuffled = [...QUESTION_BANK].sort(() => Math.random() - 0.5);
            currentQuestions = shuffled.slice(0, 10);
            currentQuestion = 0;
            score = 0;
        }

        function showQuestion() {
            const q = currentQuestions[currentQuestion];
            const progress = ((currentQuestion + 1) / 10) * 100;
            
            document.getElementById('questionNum').textContent = currentQuestion + 1;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('questionText').textContent = q.q;
            
            const container = document.getElementById('answersContainer');
            container.innerHTML = '';
            
            q.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = option;
                btn.onclick = () => selectAnswer(index);
                container.appendChild(btn);
            });
        }

        function selectAnswer(index) {
            const q = currentQuestions[currentQuestion];
            const buttons = document.querySelectorAll('.answer-btn');
            
            buttons.forEach(btn => btn.disabled = true);
            
            if (q.timmy.includes(index)) {
                score++;
            }
            
            setTimeout(() => {
                if (currentQuestion < 9) {
                    currentQuestion++;
                    showQuestion();
                } else {
                    showResult();
                }
            }, 400);
        }

        function showResult() {
            timmyPoints++;
            saveProgress();
            updateStats();
            
            let title, desc, emoji;
            if (score <= 2) {
                title = 'Big Brain Energy!';
                desc = 'You\'re definitely NOT a Timmy. Smart choices all around!';
                emoji = 'üß†';
            } else if (score <= 5) {
                title = 'Questionable Moments';
                desc = 'You\'ve got some Timmy tendencies, but you\'re mostly okay!';
                emoji = 'ü§î';
            } else if (score <= 7) {
                title = 'Certified Timmy';
                desc = 'Yup, you\'re a Timmy! But hey, we still love you!';
                emoji = 'üòÖ';
            } else {
                title = 'Supreme Timmy';
                desc = 'Congratulations! Peak Timmy status achieved. Legendary!';
                emoji = 'üéâ';
            }
            
            document.getElementById('resultEmoji').textContent = emoji;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultScore').textContent = score + '/10';
            document.getElementById('resultDesc').textContent = desc;
            
            showScreen('resultScreen');
            saveToLeaderboard(score);
        }

        function retryQuiz() {
            startQuiz();
        }

        async function saveToLeaderboard(timmyScore) {
            try {
                await fetch(`${SUPABASE_URL}/rest/v1/leaderboard`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        player_name: playerName,
                        timmy_score: timmyScore,
                        total_quizzes: timmyPoints
                    })
                });
            } catch (error) {
                console.log('Leaderboard save failed:', error);
            }
        }

        async function showLeaderboard() {
            showScreen('leaderboardScreen');
            document.getElementById('leaderboardList').innerHTML = '<div class="loading">Loading leaderboard...</div>';
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/leaderboard?select=*&order=timmy_score.desc,total_quizzes.desc&limit=10`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                const data = await response.json();
                displayLeaderboard(data);
            } catch (error) {
                document.getElementById('leaderboardList').innerHTML = '<div class="loading">Failed to load leaderboard</div>';
            }
        }

        function displayLeaderboard(data) {
            const container = document.getElementById('leaderboardList');
            
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="loading">No scores yet. Be the first!</div>';
                return;
            }
            
            container.innerHTML = data.map((entry, index) => `
                <div class="leaderboard-item">
                    <div class="leaderboard-rank">#${index + 1}</div>
                    <div class="leaderboard-name">${entry.player_name}</div>
                    <div class="leaderboard-score">${entry.timmy_score}/10 (${entry.total_quizzes} plays)</div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>